<!DOCTYPE html>
<html>
<head>
	<title>freehold</title>
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

	<!-- Bootstrap -->
	<link href="/v1/file/core/css/bootstrap.min.css" rel="stylesheet" media="screen">

	<link rel="shortcut icon" href="/v1/file/core/images/favicon.ico">
</head>
<body>
<nav class="navbar navbar-default" role="navigation">
	<div class="navbar-header">
		<a class="navbar-brand" href="/">freehold</a>
	</div>
</nav>

<div class="container">
<div class="well">
	<h3>Log In</h3>
	<form class="form" role="form" id="login" name="login">
	<span id="err" class="hidden label label-danger"></span>
		<div class="form-group">
			<label class="sr-only" for="username">Username</label>	
			<input class="form-control" id="username" name="username" placeholder="Enter username">
		</div>
		<div class="form-group">
			<label class="sr-only" for="password">Password</label>
			<input type="password" class="form-control" id="password" name="password" placeholder="Password">
		</div>
		<div class="checkbox">
			<label>
				<input type="checkbox" id="rememberMe" name="rememberMe" checked="checked"> Remember me
			</label>
		</div>
		<button type="submit" class="btn btn-default">Log In</button>
	</form>
</div>
</div>

<!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
<script src="/v1/file/core/js/jquery-2.1.1.min.js"></script>
<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="/v1/file/core/js/bootstrap.min.js"></script>
<script language="Javascript">
$(document).ready(function() { 

function err(msg) {
	$("#err").removeClass("hidden").text(msg);
}

function clearErr() {
	$("#err").addClass("hidden").text("");
}

	$( "#login" ).submit(function( event ) {
		clearErr();
		event.preventDefault();
		var data = {}

		if ($("#rememberMe").prop("checked")) {
			var today = new Date(Date.now());
			today.setDate(today.getDate() + 15); 	
			data = {
				expires: today
			}
		}
		if ($("#username").val() === "") { 
			err("Username is required");
			return;
		}

		$.ajax({
				type: "POST",
				url: "/v1/auth/session",
				beforeSend: function (xhr) {
					xhr.setRequestHeader ("Authorization", "Basic "+btoa($("#username").val()+":"+$("#password").val()));
				},
				dataType: "json",
				data: JSON.stringify(data),
				complete: function (xhr) {
					var result = JSON.parse(xhr.responseText);
					if (result.status == "success") {
						location.reload();
					} else {
						err(result.message);
					}
				},
		});
	});

});

</script>
</body>
</html>
